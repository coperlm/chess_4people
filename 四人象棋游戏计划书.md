# 四人象棋游戏开发计划书

## 1. 项目概述

### 1.1 游戏描述
- **游戏名称**: 四人象棋
- **游戏类型**: 回合制策略棋类游戏
- **玩家数量**: 4人
- **团队模式**: 对角线玩家互为队友（红-绿队 vs 蓝-黑队）
- **胜利条件**: 将死对方任意一方的将/帅

### 1.2 技术栈选择
- **前端**: HTML5 + Tailwind CSS + JavaScript (或 React/Vue.js)
- **后端**: Node.js + Express (可选，用于多人在线)
- **图形库**: Canvas 2D 或 SVG
- **网络通信**: WebSocket (用于实时对战)
- **CSS框架**: Tailwind CSS (用于快速UI开发和响应式设计)

## 2. 游戏规则设计

### 2.1 棋盘布局
- **棋盘大小**: 11×11 总格子，其中四个5×5区域可落子
- **布局**: 正方形棋盘，四个玩家分别占据四个角落的5×5区域
- **河界**: 第6行和第6列为"楚河汉界"分隔线，**不可落子**
- **九宫格**: 每个角落都有3×3的九宫格区域

#### 棋盘平面图设计（基于正确布局）

```
棋盘坐标图 (11×11网格, 0-10索引，基于旋转对称):

     0 1 2 3 4 5 6 7 8 9 10
  0  将空象卒空 河 卒空象空将
  1  车仕炮空空 河 空空炮仕车
  2  空空马卒空 河 空卒马空空
  3  卒空卒空空 河 空空兵空兵
  4  空空空空空 河 空空空空空
  5  河河河河河 河 河河河河河
  6  空空空空空 河 空空空空空
  7  兵空兵空空 河 空空卒空卒
  8  空空马卒空 河 空卒马空空
  9  车士炮空空 河 空空炮士车
 10  帅空相兵空 河 兵空相空将

区域划分:
- 左上角 (0-4, 0-4): 黑方 - 5×5可落子区域
- 右上角 (6-10, 0-4): 蓝方 - 5×5可落子区域
- 左下角 (0-4, 6-10): 红方 - 5×5可落子区域  
- 右下角 (6-10, 6-10): 绿方 - 5×5可落子区域

河界区域 (不可落子):
- 第5行 (y=5): 水平楚河汉界
- 第5列 (x=5): 垂直楚河汉界

队伍分配（对角线队友）:
- 队伍1: 红方(左下) + 蓝方(右上) - 对角线队友
- 队伍2: 绿方(右下) + 黑方(左上) - 对角线队友
```

#### 详细坐标映射（基于旋转对称布局）

```
各玩家初始棋子位置坐标（以棋盘中心为轴心旋转对称）:

黑方 (玩家3) - 左上角 (0-4, 0-4):
将: (0,0)  仕: (1,1)  象: (0,2)  
车: (1,0)  马: (2,2)   炮: (1,2)
卒: (0,3)(2,3)(3,0)(3,2) - 横向移动，向右前进

蓝方 (玩家1) - 右上角 (6-10, 0-4) [顺时针旋转90度]:  
将: (10,0) 仕: (9,1)  象: (8,0)
车: (10,1) 马: (8,2)   炮: (8,1)
兵: (7,0)(7,2)(10,3)(8,3) - 纵向移动，向下前进

绿方 (玩家2) - 右下角 (6-10, 6-10) [旋转180度]:
将: (10,10) 仕: (9,9)  象: (10,8)
车: (9,10)  马: (8,8)   炮: (9,8)
卒: (10,7)(8,7)(7,10)(7,8) - 横向移动，向左前进

红方 (玩家0) - 左下角 (0-4, 6-10) [逆时针旋转90度]:
帅: (0,10)  士: (1,9)   相: (2,10)
车: (0,9)   马: (2,8)   炮: (2,9)
兵: (3,10)(3,8)(0,7)(2,7) - 纵向移动，向上前进

兵卒移动规则:
- 兵(红蓝方): 纵向移动，过河前只能直进，过河后可左右横移
- 卒(绿黑方): 横向移动，过河前只能直进，过河后可上下纵移
```

### 2.2 棋子配置
每个玩家拥有简化的象棋棋子（基于旋转对称布局）：
- **帅/将**: 1个
- **仕/士**: 1个  
- **相/象**: 1个
- **马**: 1个
- **车**: 1个
- **炮**: 1个
- **兵/卒**: 4个

**总计每个玩家10个棋子**

### 2.3 移动规则
- **基本规则**: 遵循传统象棋移动规则
- **河界规则**: 河界位置(第5行第5列)**不可落子**，棋子必须跨越河界到达对面区域
- **特殊限制**: 
  - 帅/将不能离开各自角落的九宫格
  - 相/象不能过河界（不能跨越到其他区域）
  - **兵卒方向性规则**：
    - 兵(红蓝方): 纵向棋子，过河前只能直进，过河后可横向移动
    - 卒(绿黑方): 横向棋子，过河前只能直进，过河后可纵向移动
  - 河界不是通道，棋子必须直接跨越到对面可落子区域

### 2.4 胜负判定
- **胜利条件**: 将死任意一个敌方玩家的帅/将
- **失败条件**: 自己的帅/将被将死
- **和棋条件**: 长时间无法分出胜负

## 3. 系统架构设计

### 3.1 模块划分
```
四人象棋游戏
├── 游戏引擎模块 (GameEngine)
│   ├── 游戏状态管理 (GameState)
│   ├── 规则验证 (RuleValidator)
│   ├── 移动处理 (MoveHandler)
│   └── 胜负判定 (WinCondition)
├── 棋盘模块 (Board)
│   ├── 棋盘渲染 (BoardRenderer)
│   ├── 棋子管理 (PieceManager)
│   └── 坐标转换 (CoordinateConverter)
├── 用户界面模块 (UI)
│   ├── 游戏界面 (GameInterface)
│   ├── 菜单系统 (MenuSystem)
│   └── 提示信息 (MessageDisplay)
├── 网络模块 (Network)
│   ├── 连接管理 (ConnectionManager)
│   ├── 消息处理 (MessageHandler)
│   └── 同步机制 (SyncManager)
└── 工具模块 (Utils)
    ├── 配置管理 (ConfigManager)
    ├── 日志系统 (Logger)
    └── 工具函数 (UtilFunctions)
```

### 3.2 数据结构设计

#### 3.2.1 棋子数据结构
```javascript
class Piece {
    constructor(type, player, position) {
        this.type = type;           // 棋子类型 (将、车、马等)
        this.player = player;       // 玩家ID (0-3)
        this.position = position;   // 当前位置 {x, y}
        this.alive = true;          // 是否存活
    }
}
```

#### 3.2.2 游戏状态数据结构
```javascript
class GameState {
    constructor() {
        this.board = [];            // 11x11 二维数组
        this.currentPlayer = 0;     // 当前玩家 (0-3)
        this.players = [];          // 玩家信息数组
        this.gamePhase = 'playing'; // 游戏阶段
        this.moveHistory = [];      // 移动历史
        this.teams = {              // 队伍分配（对角线队友）
            team1: [0, 1],          // 红方(左下) + 蓝方(右上)
            team2: [2, 3]           // 绿方(右下) + 黑方(左上)
        };
        this.riverPositions = [5];  // 河界位置：第5行第5列不可落子
        this.playableAreas = {      // 可落子区域定义
            player0: {x: [0,4], y: [6,10]}, // 红方：左下
            player1: {x: [6,10], y: [0,4]}, // 蓝方：右上  
            player2: {x: [6,10], y: [6,10]}, // 绿方：右下
            player3: {x: [0,4], y: [0,4]}   // 黑方：左上
        };
    }
}
```

### 3.3 坐标系统设计
- **逻辑坐标**: 使用11×11的网格坐标系
- **显示坐标**: 转换为像素坐标用于渲染
- **玩家视角**: 每个玩家都以自己的角落为基准，支持视角旋转
- **区域划分**:
  - 黑方区域: (0-4, 0-4) - 左上角5×5可落子区域
  - 蓝方区域: (6-10, 0-4) - 右上角5×5可落子区域  
  - 红方区域: (0-4, 6-10) - 左下角5×5可落子区域
  - 绿方区域: (6-10, 6-10) - 右下角5×5可落子区域
- **河界位置**: 第5行和第5列为分隔线，**不可落子**

## 4. 用户界面设计

### 4.1 主界面布局
- **棋盘区域**: 居中显示11×11网格，其中四个5×5区域可落子
- **玩家信息区**: 四个角落显示对应玩家信息和计时器
- **控制面板**: 包含设置、悔棋、认输等按钮
- **消息区域**: 显示游戏状态和提示信息
- **河界标识**: 清晰标注"楚河汉界"分割线，视觉上区分不可落子区域

### 4.2 交互设计
- **棋子选择**: 点击棋子高亮显示
- **移动操作**: 点击目标位置完成移动
- **移动提示**: 显示可移动的位置
- **动画效果**: 棋子移动动画

### 4.3 视觉设计
- **棋盘样式**: 传统象棋棋盘风格，使用Tailwind CSS实现11×11网格
- **棋子设计**: 传统汉字棋子，不同颜色区分玩家，兵卒根据方向性设计
- **UI主题**: 古典中国风格，结合现代扁平化设计
- **响应式设计**: 使用Tailwind CSS响应式工具类适配不同屏幕尺寸
- **颜色方案**: 
  - 红方(左下): `text-red-600 bg-red-100`
  - 蓝方(右上): `text-blue-600 bg-blue-100`  
  - 绿方(右下): `text-green-600 bg-green-100`
  - 黑方(左上): `text-gray-800 bg-gray-100`
- **河界样式**: 使用特殊背景色或边框标识"楚河汉界"，明确显示不可落子区域
- **兵卒视觉区分**: 兵显示为纵向字符，卒显示为横向字符

## 5. 开发阶段规划

### 第一阶段：核心功能开发 (2-3周)
- [ ] 基础11×11棋盘渲染（四个5×5可落子区域）
- [ ] 四角布局的棋子放置和显示
- [ ] 河界不可落子的逻辑处理
- [ ] 兵卒方向性移动规则实现
- [ ] 基本移动逻辑和规则验证系统
- [ ] 回合制控制（四人轮流）

### 第二阶段：游戏逻辑完善 (2-3周)
- [ ] 完整的象棋规则实现
- [ ] 四人游戏特殊规则
- [ ] 胜负判定逻辑
- [ ] 移动历史记录
- [ ] 悔棋功能

### 第三阶段：用户体验优化 (1-2周)
- [ ] 用户界面美化
- [ ] 动画效果添加
- [ ] 音效集成
- [ ] 操作提示优化
- [ ] 错误处理完善

### 第四阶段：多人网络功能 (2-3周)
- [ ] WebSocket服务器搭建
- [ ] 房间管理系统
- [ ] 实时同步机制
- [ ] 断线重连处理
- [ ] 观战功能

### 第五阶段：测试和发布 (1-2周)
- [ ] 单元测试编写
- [ ] 集成测试
- [ ] 性能优化
- [ ] Bug修复
- [ ] 部署上线

## 6. 技术难点分析

### 6.1 坐标转换
- **问题**: 四个方向的玩家需要不同的坐标映射，河界位置不可落子
- **解决方案**: 建立通用的坐标转换系统，使用CoordinateMapper类处理四方向坐标转换和河界检测

### 6.2 河界处理
- **问题**: 河界位置不可落子，需要特殊的移动验证逻辑
- **解决方案**: 实现专门的河界检测函数，确保所有移动都跳过河界位置

### 6.2 Tailwind CSS集成
- **问题**: 需要优化CSS文件大小，避免包含未使用的样式
- **解决方案**: 配置Tailwind CSS的purge功能，只包含项目中实际使用的样式类

### 6.3 兵卒方向性
- **问题**: 兵卒有不同的移动方向性，需要特殊处理
- **解决方案**: 为兵卒实现专门的移动规则验证器

### 6.4 Tailwind CSS集成
- **问题**: 需要优化CSS文件大小，避免包含未使用的样式
- **解决方案**: 配置Tailwind CSS的purge功能，只包含项目中实际使用的样式类

### 6.5 规则验证
- **问题**: 四人游戏的复杂规则验证，包含河界限制和兵卒方向性
- **解决方案**: 模块化的规则验证器，分别处理不同类型棋子的移动规则

### 6.6 网络同步
- **问题**: 四个客户端的状态同步
- **解决方案**: 权威服务器模式

### 6.7 性能优化
- **问题**: 复杂的游戏状态计算
- **解决方案**: 增量更新和缓存机制

## 7. 文件结构规划

```
chess-game/
├── index.html              # 主页面
├── css/
│   ├── input.css           # Tailwind CSS 输入文件
│   └── output.css          # 编译后的CSS文件
├── js/
│   ├── main.js             # 主程序入口
│   ├── game/
│   │   ├── GameEngine.js   # 游戏引擎
│   │   ├── GameState.js    # 游戏状态
│   │   ├── RuleValidator.js # 规则验证
│   │   └── WinCondition.js # 胜负判定
│   ├── board/
│   │   ├── Board.js        # 棋盘类
│   │   ├── BoardRenderer.js # 棋盘渲染
│   │   ├── CoordinateMapper.js # 坐标映射工具
│   │   └── PieceManager.js # 棋子管理
│   ├── ui/
│   │   ├── GameInterface.js # 游戏界面
│   │   ├── MenuSystem.js   # 菜单系统
│   │   └── MessageDisplay.js # 消息显示
│   ├── network/
│   │   ├── NetworkManager.js # 网络管理
│   │   └── MessageHandler.js # 消息处理
│   └── utils/
│       ├── Config.js       # 配置文件
│       ├── Logger.js       # 日志系统
│       └── Utils.js        # 工具函数
├── assets/
│   ├── images/             # 图片资源
│   │   ├── pieces/         # 棋子图片
│   │   └── board/          # 棋盘背景
│   └── sounds/             # 音效文件
├── server/                 # 服务端代码 (可选)
│   ├── server.js           # 服务器主文件
│   ├── GameRoom.js         # 游戏房间管理
│   └── MessageHandler.js   # 服务端消息处理
├── tailwind.config.js      # Tailwind CSS 配置文件
├── package.json            # 项目依赖
└── README.md               # 项目说明文档
```

## 8. 后续扩展功能

### 8.1 AI对手
- 实现不同难度的AI玩家
- 支持人机混合对战

### 8.2 游戏回放
- 录制游戏过程
- 支持回放和分析

### 8.3 排行榜系统
- 玩家等级系统
- 战绩统计

### 8.4 自定义规则
- 允许玩家自定义游戏规则
- 支持不同的变体玩法

---

**注意**: 本计划书为初版，可根据实际开发过程中的需求变化进行调整和完善。
